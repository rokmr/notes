name: Append NeRF notebook to nerf.md

on:
  schedule:
    - cron: '0 0 * * 1'  # Every Monday
  workflow_dispatch:

jobs:
  render_nerf_nb:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout destination repo
        uses: actions/checkout@v3

      - name: Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.10'

      - name: Install dependencies
        run: pip install notebook nbconvert

      - name: Download NeRF notebook
        run: |
          mkdir -p temp
          curl -L -o temp/NeRF.ipynb https://raw.githubusercontent.com/rokmr/Computer-Vision/main/src/colab/NeRF.ipynb

      - name: Convert notebook to markdown
        run: |
          jupyter nbconvert --to markdown temp/NeRF.ipynb --output temp/nerf_converted.md

      - name: Merge embed HTML with notebook markdown
        run: |
          echo "" >> nerf.md
          echo "---" >> nerf.md
          echo "ðŸ““ This section is auto-generated from the [NeRF.ipynb](https://github.com/rokmr/Computer-Vision/blob/main/src/colab/NeRF.ipynb)." >> nerf.md
          echo "" >> nerf.md
          tail -n +1 temp/nerf_converted.md >> nerf.md

      - name: Commit and push changes
        run: |
          git config user.name "github-actions[bot]"
          git config user.email "github-actions[bot]@users.noreply.github.com"
          git add nerf.md
          git commit -m "Auto-append notebook to nerf.md" || echo "No changes to commit"
          git push